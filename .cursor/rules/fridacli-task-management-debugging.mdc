---
description: fridacli任务管理系统调试和问题排查指南
---

# fridacli 任务管理系统调试指南

## 常见问题排查流程

### 1. jobs命令找不到任务
**症状**: 执行`jobs()`显示"没有找到任务"，但Hook函数已执行
**排查步骤**:
1. 检查[frida_job_commands.js](mdc:frida_job_commands.js)中`jobs`函数是否正确导出到`global.jobs`
2. 确认RPC导出中`jobs: typeof jobs !== 'undefined' ? jobs : fallbackFunction`
3. 验证任务管理器加载顺序：先[frida_job_manager.js](mdc:frida_job_manager.js)后[frida_job_commands.js](mdc:frida_job_commands.js)

### 2. kill命令无法取消Hook
**症状**: 执行`kill(1)`或`killall()`后Hook继续工作
**技术限制**: Java Hook无法像Native Hook通过`detach()`完全移除
**解决方案**:
- 任务状态标记为`cancelled`
- Hook函数检查任务状态：`if (job && job.status !== 'cancelled')`
- 停止统计计数，但Hook代码仍存在

### 3. 自动注册任务缺失
**症状**: Hook函数执行但没有创建任务记录
**检查点**:
1. `HookJobManager.autoRegisterHook()`是否被调用
2. 函数是否在`remainingHookFunctions`自动包装列表中
3. 手动集成的函数是否包含任务注册代码

## 调试技巧

### 立即检查清单
1. **直接读取关键文件** - 不依赖搜索结果
2. **验证函数导出** - 检查`global.functionName = functionName`
3. **确认加载顺序** - 任务管理器→命令接口→包装逻辑
4. **测试完整流程** - 创建→查看→取消→验证

### 技术限制认知
- **Java Hook**: 修改类implementation，无法detach，只能状态管理
- **Native Hook**: 返回Interceptor对象，可完全detach
- **自动追踪任务**: 特殊处理，通过状态检查控制行为

### 最佳实践
- 重要Hook函数使用手动任务集成
- 一般Hook函数使用自动包装
- 所有Hook函数都要检查任务状态
- 提供清晰的用户反馈和限制说明