---
globs: fridac/**/*.js
description: Frida JavaScript Hookå¼€å‘è§„èŒƒå’Œå¸¸è§æ¨¡å¼ï¼ˆnew ç³»åˆ—è„šæœ¬ï¼‰
---
## Frida JavaScript Hook è§„èŒƒï¼ˆnew ç³»åˆ—ï¼‰

### åŸºç¡€åŸåˆ™
- æ‰€æœ‰ Java æ“ä½œåŒ…è£¹åœ¨ `Java.perform()` ä¸­
- ç»Ÿä¸€è¾“å‡º `LOG()`ï¼Œç¦æ­¢ `console.log()`ï¼ˆè§ [frida_common_new.js](mdc:fridac/frida_common_new.js)ï¼‰
- å‘½åï¼šJava å±‚æ— å‰ç¼€ï¼ˆå¦‚ `traceClass`ï¼‰ï¼›Native å±‚ä½¿ç”¨ `native` å‰ç¼€

### ClassLoader å¤„ç†
```javascript
function hookJavaClass(className) {
  var hook = null;
  try {
    hook = Java.use(className);
  } catch (e) {
    if ((e.message||'').includes('ClassNotFoundException')) {
      var loader = findTragetClassLoader(className);
      if (loader) hook = Java.ClassFactory.get(loader).use(className);
      else return null;
    } else { return null; }
  }
  return hook;
}
```

### å·²åŠ è½½ç±»æšä¸¾
- ä¼˜å…ˆä½¿ç”¨ `Java.enumerateLoadedClassesSync()`ï¼Œé¿å… callback ç‰ˆ API åœ¨éƒ¨åˆ†ç¯å¢ƒå‡ºç° `onMatch` æœªå®šä¹‰é”™è¯¯

### æ–¹æ³• Hook æ¨¡æ¿
```javascript
hook[methodName].implementation = function() {
  LOG("\n*** è¿›å…¥ " + fullMethodName);
  // å‚æ•°æ‰“å°...
  var ret = this[methodName].apply(this, arguments);
  LOG("ğŸ“¤ è¿”å›å€¼: " + ret);
  return ret;
}
```

### å¯¼å‡ºè§„åˆ™
- éœ€è¦åœ¨äº¤äº’æˆ– RPC ä¸­è°ƒç”¨çš„å‡½æ•°ï¼Œå¿…é¡» `global.func = func`
- å…³é”®å‡½æ•°ï¼š`smartTrace`, `traceClass`, `traceMethod`, `findClasses`, `enumAllClasses`ï¼ˆè§ [frida_common_new.js](mdc:fridac/frida_common_new.js)ï¼‰
