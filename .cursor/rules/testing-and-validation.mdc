---
description: fridacli测试策略和验证方法
---

# 测试策略和验证方法

## 单元测试策略

### JavaScript逻辑测试
使用独立的Node.js脚本测试核心逻辑：

```javascript
// 测试smartTrace识别逻辑
function testSmartTraceLogic(target) {
    // 模拟识别逻辑
    var result = simulateSmartTrace(target);
    console.log("目标:", target, "识别为:", result);
}

var testCases = [
    "com.meituan.android.common.mtguard.MainBridge.main",  // 应该识别为类
    "com.example.MainActivity.onCreate",                    // 应该识别为方法  
    "com.example.Helper.doSomething()",                     // 应该识别为方法
    "android.app.Activity",                                 // 应该识别为类
    "malloc"                                                // 应该识别为Native
];
```

### Python CLI测试
```python
# 版本检查测试
def test_version_detection():
    env_info = detect_python_environment()
    assert env_info['version'] != 'unknown'
    assert env_info['frida_version'] != 'unknown'

# 命令行参数测试  
def test_command_line_parsing():
    # 测试各种参数组合
    assert parse_args(['-f', 'com.example.app'])
    assert parse_args(['-p', 'com.example.app']) 
    assert parse_args(['-a'])
```

## 集成测试方法

### 真实设备测试
1. **连接测试**
   ```bash
   ./fridac --version  # 检查基础功能
   ./fridac -a         # 测试应用列表
   ```

2. **Hook功能测试**
   ```javascript
   // 在fridac交互环境中
   help()                                              // 检查函数列表
   smartTrace("android.app.Activity")                 // 测试系统类
   smartTrace("com.android.internal.app.AlertActivity") // 测试内部类
   ```

### 错误场景测试
1. **ClassNotFoundException测试**
   - 测试不存在的类
   - 测试动态加载的类
   - 测试自定义ClassLoader中的类

2. **网络和权限测试**
   - 设备连接失败场景
   - frida-server未运行场景
   - 权限不足场景

## 回归测试清单

### 核心功能验证
- [ ] `smartTrace` 函数正确导出
- [ ] `loadNativeSupport` 函数可用
- [ ] `findStrInMap` 函数正确工作
- [ ] ClassLoader搜索功能正常
- [ ] 路径信息正确显示

### 兼容性验证
- [ ] Python 3.6.8+ 支持
- [ ] Rich库可选依赖处理
- [ ] 不同Android版本兼容
- [ ] 不同Frida版本兼容

### 用户体验验证
- [ ] Tab补全功能正常
- [ ] 命令历史保存/加载
- [ ] 彩色输出正确显示
- [ ] 错误信息友好易懂

## 调试工具和技巧

### 日志级别控制
```javascript
// 开发模式：详细日志
var DEBUG_MODE = true;
function debugLog(message) {
    if (DEBUG_MODE) {
        LOG("[DEBUG] " + message, { c: Color.Magenta });
    }
}
```

### 性能监控
```javascript
function timeFunction(funcName, func) {
    var start = Date.now();
    var result = func();
    var end = Date.now();
    LOG(funcName + " 执行时间: " + (end - start) + "ms", { c: Color.Yellow });
    return result;
}
```

### 内存使用监控
```python
import psutil
import gc

def monitor_memory():
    process = psutil.Process()
    memory_info = process.memory_info()
    print(f"内存使用: {memory_info.rss / 1024 / 1024:.1f} MB")
    
    # 强制垃圾回收
    gc.collect()
```

## 测试数据和用例

### 常见Android应用类
```javascript
var testTargets = {
    "系统类": [
        "android.app.Activity",
        "android.content.Context", 
        "android.os.Bundle"
    ],
    "常见方法": [
        "android.app.Activity.onCreate",
        "android.app.Activity.onResume",
        "android.content.Context.getSystemService"
    ],
    "动态加载类": [
        "com.meituan.android.common.mtguard.MainBridge",
        "com.tencent.tinker.loader.TinkerLoader",
        "com.alibaba.android.arouter.core.LogisticsCenter"
    ]
};
```

### 错误场景模拟
```javascript
var errorScenarios = [
    "com.nonexistent.Class",           // 不存在的类
    "com.example.Class.nonMethod",     // 不存在的方法
    "invalid.class.name.",             // 无效的类名
    "",                                // 空字符串
    "java.lang.Object.hashCode(int)"   // 错误的方法签名
];
```

## 自动化测试框架

### 测试脚本结构
```bash
#!/bin/bash
# test_fridac.sh

echo "开始fridac自动化测试..."

# 1. 基础功能测试
./fridac --version || exit 1

# 2. 语法检查
python3 -m py_compile fridac || exit 1

# 3. JavaScript语法检查  
node -c frida_common.js || exit 1
node -c frida_native_common.js || exit 1
node -c frida_location_hooks.js || exit 1

# 4. 逻辑测试
node test_smartTrace_logic.js || exit 1

echo "所有测试通过！"
```

### 持续集成建议
1. 每次提交都运行基础测试
2. 定期运行完整的设备测试
3. 监控内存使用和性能指标
4. 自动生成测试报告