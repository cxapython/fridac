---
description: smartTraceå‡½æ•°æ™ºèƒ½è¯†åˆ«é€»è¾‘å’Œä¿®å¤æŒ‡å—
---

# smartTrace æ™ºèƒ½è¯†åˆ«é€»è¾‘

## è®¾è®¡åŸåˆ™

`smartTrace` å‡½æ•°ä½œä¸ºç»Ÿä¸€å…¥å£ï¼Œéœ€è¦æ™ºèƒ½è¯†åˆ«ç›®æ ‡ç±»å‹å¹¶è°ƒç”¨ç›¸åº”çš„Hookå‡½æ•°ã€‚

## è¯†åˆ«ä¼˜å…ˆçº§

### 1. æ˜ç¡®çš„æ–¹æ³•ç­¾åï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
```javascript
if (target.includes('(')) {
    LOG("æ£€æµ‹åˆ° Java æ–¹æ³•(å¸¦ç­¾å)ï¼Œä½¿ç”¨ traceMethod", { c: Color.Cyan });
    return traceMethod(target, options.showTrace, options.returnValue);
}
```

### 2. æ˜ç¡®æŒ‡å®šçš„ç±»å‹
```javascript
if (options.isMethod) {
    LOG("æ£€æµ‹åˆ° Java æ–¹æ³•(æ˜ç¡®æŒ‡å®š)ï¼Œä½¿ç”¨ traceMethod", { c: Color.Cyan });
    return traceMethod(target, options.showTrace, options.returnValue);
}
```

### 3. å¸¸è§æ–¹æ³•åè¯†åˆ«
```javascript
var commonMethods = ['onCreate', 'onResume', 'onPause', 'onDestroy', 'onStart', 'onStop', 'onRestart'];
var parts = target.split('.');
if (parts.length >= 3) {
    var lastPart = parts[parts.length - 1];
    if (commonMethods.includes(lastPart)) {
        LOG("æ£€æµ‹åˆ° Java æ–¹æ³•(æ™ºèƒ½è¯†åˆ«)ï¼Œä½¿ç”¨ traceMethod", { c: Color.Cyan });
        return traceMethod(target, options.showTrace, options.returnValue);
    }
}
```

### 4. é»˜è®¤ç±»å¤„ç†ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
```javascript
// é»˜è®¤å½“ä½œç±»å¤„ç†ï¼Œæ”¯æŒåŠ¨æ€ClassLoader
LOG("æ£€æµ‹åˆ° Java ç±»ï¼Œä½¿ç”¨ traceClass", { c: Color.Cyan });
return traceClass(target);
```

## åŠ¨æ€ClassLoaderæ”¯æŒ

æ‰€æœ‰é€šè¿‡ `smartTrace` è°ƒç”¨çš„å‡½æ•°éƒ½å¿…é¡»æ”¯æŒåŠ¨æ€ClassLoaderï¼š

### traceClass å¢å¼º
- è‡ªåŠ¨æ£€æµ‹ ClassNotFoundException
- è°ƒç”¨ `findTragetClassLoader` æŸ¥æ‰¾æ­£ç¡®çš„ClassLoader
- æ˜¾ç¤ºè¯¦ç»†çš„ClassLoaderä¿¡æ¯å’Œæ–‡ä»¶è·¯å¾„

### traceMethod å¢å¼º
- åŒæ ·çš„ClassLoaderå›é€€æœºåˆ¶
- ä¿æŒåŸæœ‰çš„æ–¹æ³•Hooké€»è¾‘
- å¢å¼ºçš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•è¾“å‡º

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šRPCå¯¼å‡ºæœªå®šä¹‰
**ç—‡çŠ¶**ï¼š`'smartTrace' is not defined`
**åŸå› **ï¼šRPC exports ä¸­ä½¿ç”¨äº†æ¡ä»¶æ£€æŸ¥ï¼Œåœ¨è„šæœ¬åŠ è½½æ—¶å‡½æ•°è¿˜æœªå®šä¹‰
**è§£å†³**ï¼šç›´æ¥å¯¼å‡ºè€Œä¸æ˜¯æ¡ä»¶æ£€æŸ¥
```javascript
// é”™è¯¯çš„æ–¹å¼
smartTrace: typeof smartTrace !== 'undefined' ? smartTrace : function() {...}

// æ­£ç¡®çš„æ–¹å¼  
smartTrace: smartTrace,
```

### é—®é¢˜2ï¼šç±»è¯†åˆ«é”™è¯¯
**ç—‡çŠ¶**ï¼šæ–¹æ³•è¢«è¯†åˆ«ä¸ºç±»ï¼Œå¯¼è‡´ClassNotFoundException
**åŸå› **ï¼šæ™ºèƒ½è¯†åˆ«é€»è¾‘è¿‡äºæ¿€è¿›
**è§£å†³**ï¼šä¿å®ˆçš„è¯†åˆ«ç­–ç•¥ï¼Œä¼˜å…ˆå½“ä½œç±»å¤„ç†

### é—®é¢˜3ï¼šåŠ¨æ€åŠ è½½ç±»æ‰¾ä¸åˆ°
**ç—‡çŠ¶**ï¼šClassNotFoundException for dynamically loaded classes
**åŸå› **ï¼šç±»åœ¨è‡ªå®šä¹‰ClassLoaderä¸­
**è§£å†³**ï¼šå¢å¼ºClassLoaderæŸ¥æ‰¾å’Œä¿¡æ¯æ˜¾ç¤º

## è°ƒè¯•å’Œæ—¥å¿—

### å¿…éœ€çš„æ—¥å¿—ä¿¡æ¯
1. è¯†åˆ«ç»“æœï¼šæ˜¾ç¤ºè¯†åˆ«ä¸ºç±»è¿˜æ˜¯æ–¹æ³•
2. ClassLoaderæœç´¢è¿‡ç¨‹ï¼šæ˜¾ç¤ºæœç´¢è¿›åº¦
3. æ–‡ä»¶è·¯å¾„ä¿¡æ¯ï¼šæ˜¾ç¤ºç±»çš„æ¥æºæ–‡ä»¶
4. æˆåŠŸç¡®è®¤ï¼šæ˜¾ç¤ºHookæ“ä½œçš„ç»“æœ

### æ—¥å¿—æ ¼å¼æ ‡å‡†
```javascript
LOG("âœ… æ‰¾åˆ°ç›®æ ‡ç±» '" + targetClass + "' åœ¨ClassLoader: " + loader, { c: Color.Green });
LOG("ğŸ“ ClassLoaderç±»å‹: " + loaderInfo.type, { c: Color.Cyan });
LOG("ğŸ“‚ æ–‡ä»¶è·¯å¾„:", { c: Color.Yellow });
LOG("ğŸ”— çˆ¶ClassLoader: " + loaderInfo.parentLoader, { c: Color.Blue });
```

## æµ‹è¯•ç”¨ä¾‹

### åº”è¯¥è¯†åˆ«ä¸ºç±»çš„æƒ…å†µ
- `"com.meituan.android.common.mtguard.MainBridge.main"`
- `"com.example.MainActivity"`
- `"android.app.Activity"`

### åº”è¯¥è¯†åˆ«ä¸ºæ–¹æ³•çš„æƒ…å†µ
- `"com.example.MainActivity.onCreate"`
- `"com.example.Helper.doSomething()"`
- æ˜ç¡®æŒ‡å®š `options.isMethod = true` çš„æƒ…å†µ