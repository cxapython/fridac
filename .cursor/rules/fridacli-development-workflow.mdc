---
description: fridacli项目开发工作流程和贡献指南
---

# fridacli 开发工作流程

## 项目架构概览

fridacli 是一个多层架构的 Frida Hook 工具集：

### 核心层次
1. **CLI层** - [fridac](mdc:fridac) Python主程序，提供交互环境
2. **JavaScript层** - Hook工具集和任务管理系统
3. **管理层** - 任务管理、自动追踪、智能补全
4. **用户层** - Rich界面、帮助系统、错误处理

### 关键模块
- **Java Hook**: [frida_common.js](mdc:frida_common.js) - 类追踪、方法Hook、ClassLoader处理
- **Native Hook**: [frida_native_common.js](mdc:frida_native_common.js) - SO分析、加密Hook、网络监控
- **定位Hook**: [frida_location_hooks.js](mdc:frida_location_hooks.js) - Base64、Toast、HashMap等组件Hook
- **高级追踪**: [frida_advanced_tracer.js](mdc:frida_advanced_tracer.js) - 基于r0tracer的高级功能
- **任务管理**: [frida_job_manager.js](mdc:frida_job_manager.js) + [frida_job_commands.js](mdc:frida_job_commands.js)

## 开发流程

### 1. 新功能开发
```bash
# 1. 分析需求
# - 确定功能属于哪个层次（Java/Native/定位/高级）
# - 设计API接口和参数规范
# - 考虑任务管理集成

# 2. 实现Hook函数
# - 使用标准模板添加自动任务追踪
# - 遵循命名规范和错误处理规范
# - 添加详细的中文注释

# 3. 集成到主程序
# - 在fridac的RPC exports中导出函数
# - 添加到自动补全系统
# - 更新help()函数

# 4. 更新文档
# - 更新README.md中的函数列表
# - 添加使用示例
# - 更新ADVANCED_FEATURES.md（如适用）
```

### 2. Bug修复流程
```bash
# 1. 问题定位
# - 检查linter错误
# - 查看任务管理器状态
# - 验证RPC导出正确性

# 2. 修复验证
# - 运行affected测试
# - 验证向下兼容性
# - 确认任务管理功能正常

# 3. 回归测试
# - 测试基本Hook功能
# - 验证任务管理命令
# - 检查自动补全功能
```

### 3. 重构指南
```bash
# 1. 保持API稳定性
# - 不破坏现有函数签名
# - 保持向下兼容
# - 渐进式改进

# 2. 代码质量
# - 遵循现有代码风格
# - 添加必要的错误处理
# - 保持函数职责单一

# 3. 文档同步
# - 及时更新相关文档
# - 保持示例代码最新
# - 更新Cursor Rules
```

## 测试策略

### 功能测试检查清单
```javascript
// 基础Hook功能
- [ ] hookLog() 正常工作
- [ ] hookBase64() 正常工作  
- [ ] traceClass() 正常工作
- [ ] Native Hook函数正常工作

// 任务管理功能
- [ ] jobs() 显示所有任务
- [ ] job(id) 显示任务详情
- [ ] kill(id) 取消任务
- [ ] pause/resume 功能正常
- [ ] 自动任务注册正常

// 用户体验
- [ ] Tab补全功能正常
- [ ] help() 信息完整
- [ ] 错误提示清晰
- [ ] Rich界面美观
```

### 性能测试
```javascript
// 任务管理性能
- [ ] 大量任务创建(<100ms)
- [ ] 任务查询响应快速(<10ms) 
- [ ] 内存使用合理(<100MB)
- [ ] 无内存泄漏

// Hook性能
- [ ] Hook创建延迟最小
- [ ] 命中统计准确
- [ ] 批量操作高效
```

## 代码规范

### JavaScript规范
```javascript
// 1. 函数命名
function hookFunctionName() {}        // 定位Hook用hook前缀
function nativeFunctionName() {}      // Native Hook用native前缀
function traceFunctionName() {}       // Java Hook无前缀

// 2. 参数规范
function hookFunction(showStack) {    // showStack统一用1/0
    showStack = showStack || 0;
    var needStack = showStack === 1;
}

// 3. 日志规范
LOG("✅ 成功信息", { c: Color.Green });
LOG("❌ 错误信息", { c: Color.Red });
LOG("🎯 Hook触发", { c: Color.Cyan });

// 4. 任务集成规范
var taskId = null;
if (typeof HookJobManager !== 'undefined') {
    taskId = HookJobManager.autoRegisterHook('functionName', [args]);
}
```

### Python规范
参考 [fridac](mdc:fridac) 中的实现：
```python
# 1. 向下兼容Python 3.6.8+
# 2. Rich库优雅降级处理
# 3. 详细的错误处理和用户提示
# 4. 统一的日志函数使用
```

## 文档维护

### 必须更新的文档
1. **[README.md](mdc:README.md)** - 新功能介绍和使用示例
2. **函数列表** - 完整的函数参考表格
3. **实战案例** - 实际使用场景演示
4. **安装指南** - 环境要求和安装步骤

### 可选更新的文档
1. **ADVANCED_FEATURES.md** - 高级功能详细说明
2. **JOB_MANAGEMENT.md** - 任务管理系统文档
3. **Cursor Rules** - 开发规范和最佳实践

## 发布流程

### 版本发布检查
```bash
# 1. 代码质量检查
- [ ] 无linter错误
- [ ] 所有测试通过
- [ ] 文档更新完整

# 2. 功能完整性检查  
- [ ] 核心功能正常
- [ ] 任务管理稳定
- [ ] 用户体验良好

# 3. 兼容性检查
- [ ] Python 3.6.8+兼容
- [ ] Frida 14.0.0+兼容
- [ ] 向下兼容保证

# 4. 发布准备
- [ ] 更新版本号
- [ ] 更新CHANGELOG
- [ ] 准备发布说明
```

### 部署建议
```bash
# 全局安装推荐路径
/usr/local/bin/fridac              # 主程序
/usr/local/bin/frida_*.js          # Hook工具集

# 用户项目集成
./fridac                           # 项目内使用
./frida_*.js                       # Hook工具文件
```

## 贡献指南

### 提交规范
```bash
feat: 添加新的Hook功能
fix: 修复任务管理bug  
docs: 更新README文档
refactor: 重构Hook函数结构
perf: 优化任务查询性能
test: 添加单元测试
style: 代码格式调整
```

### Code Review要点
1. **功能正确性** - Hook逻辑是否正确
2. **任务集成** - 自动追踪是否正常
3. **错误处理** - 异常情况处理是否完善
4. **文档完整** - 是否有充分的注释和文档
5. **性能影响** - 是否对整体性能有负面影响

### 社区贡献
- 欢迎提交Issue报告问题
- 欢迎提交PR贡献代码
- 欢迎改进文档和示例
- 欢迎分享使用经验和最佳实践